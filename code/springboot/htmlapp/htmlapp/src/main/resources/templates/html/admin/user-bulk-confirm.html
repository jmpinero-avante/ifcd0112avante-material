<!-- vim: set tabstop=2 softtabstop=2 shiftwidth=2 noexpandtab textwidth=80 : -->

<!--
===============================================================================
PLANTILLA: CONFIRMACIÓN DE OPERACIÓN MASIVA (ADMIN)
===============================================================================
Se muestra antes de ejecutar una operación en bloque sobre usuarios
(otorgar/quitar admin o eliminar). Incluye una cuenta atrás de seguridad.
===============================================================================
-->

<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragments/layout :: layout(
        title='Confirmar operación',
        content=~{::main},
        scripts=~{::script}
      )}">

<main class="text-center">
	<section class="mt-4 mb-3">
		<h1>Confirmar operación</h1>
		<p class="text-muted">
			Revisa la lista de usuarios afectados antes de continuar.
		</p>
	</section>

	<!-- TABLA DE USUARIOS SELECCIONADOS -->
	<div class="table-container">
		<table>
			<thead>
				<tr>
					<th>Email</th>
					<th>Nombre completo</th>
					<th>Administrador</th>
					<th>Fecha de creación</th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="u : ${selectedUsers}">
					<td th:text="${u.email}">usuario@example.com</td>
					<td th:text="${u.fullName}">Nombre Apellido</td>
					<td>
						<span th:if="${u.isAdmin}" class="badge-admin">Sí</span>
						<span th:if="${!u.isAdmin}" class="badge-normal">No</span>
					</td>
					<td th:text="${#temporals.format(u.creationTimestamp, 'yyyy-MM-dd HH:mm')}">
						2025-01-01 12:00
					</td>
				</tr>
			</tbody>
		</table>
	</div>

	<!-- MENSAJE Y CUENTA ATRÁS -->
	<div class="mt-3">
		<p class="warning-text">
			¿Estás seguro de que deseas 
			<span th:text="${operationLabel}">eliminar</span> 
			estos usuarios?
		</p>
		<p>Podrás confirmar en <span id="countdown">5</span> segundos...</p>
	</div>

	<!-- BOTONES DE ACCIÓN -->
	<div class="mt-4">
		<form th:action="@{/admin/users/bulk}" method="post">
			<input type="hidden" name="action" th:value="${action}" />
			<input type="hidden" name="ids"
			       th:each="id : ${selectedIds}"
			       th:value="${id}" />

			<button id="confirmBtn" type="submit" class="btn btn-danger" disabled>
				Sí, confirmar operación
			</button>
			<a class="btn btn-muted" th:href="@{/admin/users}">
				Cancelar
			</a>
		</form>
	</div>
</main>

<!-- =======================
     BLOQUE DE SCRIPTS INYECTABLE
     ======================= -->
<script>
/**
 * Maneja la cuenta atrás antes de permitir la confirmación.
 */
document.addEventListener("DOMContentLoaded", () => {
	const countdown = document.getElementById("countdown");
	const confirmBtn = document.getElementById("confirmBtn");
	let timeLeft = 5;

	const timer = setInterval(() => {
		timeLeft--;
		countdown.textContent = timeLeft;
		if (timeLeft <= 0) {
			clearInterval(timer);
			countdown.textContent = "0";
			confirmBtn.disabled = false;
			confirmBtn.textContent = "Sí, confirmar ahora";
		}
	}, 1000);
});
</script>

</html>

<!--
===============================================================================
NOTAS PEDAGÓGICAS
===============================================================================
1. FLUJO DE USO
----------------
Esta vista se muestra antes de que `UserListController` ejecute realmente
una operación en bloque. Se genera dinámicamente en el servidor con los
usuarios seleccionados y el tipo de operación (`action`).

2. SEGURIDAD VISUAL
--------------------
El retraso de 5 segundos impide confirmaciones accidentales.
Hasta que termina la cuenta atrás, el botón de confirmar está deshabilitado.

3. DATOS DINÁMICOS
-------------------
- `${selectedUsers}`: lista completa de objetos User seleccionados.
- `${selectedIds}`: lista simple de IDs enviada al formulario.
- `${operationLabel}`: texto humanizado de la acción (por ejemplo,
  "eliminar", "otorgar privilegios de administrador"...).

4. RENDERIZADO CONDICIONAL
----------------------------
Los roles se muestran con distintivos (`.badge-admin`, `.badge-normal`)
y se reutiliza el estilo general de tablas de `base.css`.

5. INTEGRACIÓN CON LAYOUT
--------------------------
La plantilla usa el layout principal `layout(title, content, scripts)`,
heredando automáticamente la cabecera, sidebar y pie de página.

6. OBJETIVO PEDAGÓGICO
------------------------
Esta página enseña cómo:
 - Pasar listas dinámicas desde el modelo a la vista.
 - Implementar medidas de seguridad visual (cuenta atrás).
 - Reutilizar componentes comunes mediante el layout principal.
===============================================================================
-->