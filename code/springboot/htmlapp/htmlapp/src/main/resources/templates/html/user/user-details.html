<!-- vim: set tabstop=2 softtabstop=2 shiftwidth=2 noexpandtab textwidth=80 : -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragments/layout :: layout(
        title='Datos del usuario',
        content=~{::main}
      )}">

<!--
===============================================================================
PLANTILLA: user-details.html
===============================================================================
Muestra los datos personales de un usuario.  
El contenido visible varía según el rol del usuario logado y la cuenta
que se esté visualizando:
 - Usuario normal → ve solo sus propios datos.
 - Administrador → puede ver y gestionar cualquier cuenta.
===============================================================================
-->

<main>
  <section class="user-details">

    <h1>Datos del usuario</h1>

    <div class="user-info-card">
      <p><strong>ID:</strong> <span th:text="${user.id}">1</span></p>
      <p><strong>Nombre completo:</strong>
         <span th:text="${user.fullName ?: '—'}">Juan Pérez</span></p>
      <p><strong>Email:</strong>
         <span th:text="${user.email}">juan@example.com</span></p>
      <p><strong>Fecha de creación:</strong>
         <span th:text="${#temporals.format(user.creationTimestamp, 'dd/MM/yyyy HH:mm')}">
           01/01/2025 12:00
         </span></p>

      <!-- Solo los administradores ven el rol del usuario mostrado -->
      <div th:if="${loggedUser != null and loggedUser.isAdmin}">
        <p th:if="${user.isAdmin}" class="admin-label">
          <strong>Rol:</strong> <span class="badge-admin">Administrador</span>
        </p>
        <p th:if="${!user.isAdmin}" class="user-label">
          <strong>Rol:</strong> <span class="badge-user">Usuario estándar</span>
        </p>
      </div>
    </div>

    <!-- ============================================================
         BOTONES DE ACCIÓN
    ============================================================ -->
    <div class="actions">

      <!-- Caso 1: Usuario logado (normal o admin) viendo su propio perfil -->
      <div th:if="${loggedUser != null and loggedUser.id == user.id}">
        <a th:href="@{'/user/edit/' + ${user.id}}" class="btn">Modificar datos</a>
        <a th:href="@{'/user/change-password/' + ${user.id}}" class="btn">Cambiar contraseña</a>
        <a th:href="@{'/user/delete/' + ${user.id}}" class="btn btn-danger">Darse de baja</a>
      </div>

      <!-- Caso 2: Administrador viendo la cuenta de otro usuario -->
      <div th:if="${loggedUser != null and loggedUser.isAdmin and loggedUser.id != user.id}">
        <a th:href="@{'/user/edit/' + ${user.id}}" class="btn">Modificar datos</a>
        <a th:href="@{'/user/change-password/' + ${user.id}}" class="btn">Cambiar contraseña</a>
        <a th:href="@{'/user/delete/' + ${user.id}}" class="btn btn-danger">Eliminar usuario</a>

        <a th:if="${!user.isAdmin}"
           th:href="@{'/user/make-admin/' + ${user.id}}"
           class="btn btn-accent">Hacer administrador</a>

        <a th:if="${user.isAdmin}"
           th:href="@{'/user/revoke-admin/' + ${user.id}}"
           class="btn btn-warning">Quitar privilegios</a>
      </div>
    </div>

  </section>
</main>

<!--
===============================================================================
ESTILOS SUGERIDOS
===============================================================================
- .user-info-card → fondo blanco, borde sutil, sombra ligera, padding amplio.
- .actions → margen superior (p. ej. margin-top: 1.5rem).
- .btn, .btn-danger, .btn-accent, .btn-warning → definidos en base.css.
- .badge-admin → color distintivo (azul oscuro, dorado o verde).
- .badge-user → color neutro gris-azulado.
===============================================================================

NOTAS PEDAGÓGICAS
===============================================================================
1. VISIBILIDAD CONDICIONAL
--------------------------
- Los bloques <div th:if="..."> permiten mostrar elementos según el usuario.
- Esto evita mostrar botones o información sensible a usuarios sin permiso.

2. FORMATEO DE FECHAS
---------------------
- Se usa `#temporals.format(...)` para renderizar LocalDateTime con formato
  legible para el usuario (día/mes/año y hora).

3. USO DE LAYOUT
----------------
- Esta plantilla no incluye header, footer ni sidebar directamente.
- El layout base (layout.html) los inserta automáticamente.
===============================================================================
-->
</html>