<!-- vim: set tabstop=2 softtabstop=2 shiftwidth=2 noexpandtab textwidth=80 : -->

<!--
===============================================================================
PLANTILLA: CONFIRMACIÓN DE BORRADO DE USUARIO
===============================================================================
Esta vista solicita la confirmación explícita antes de eliminar un usuario.
Incluye una cuenta atrás de 5 segundos antes de habilitar el botón de borrado.
===============================================================================
-->

<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragments/layout :: layout(
        title='Confirmar eliminación de usuario',
        content=~{::main},
        scripts=~{::script}
      )}">

<main>
	<section class="text-center mt-4">
		<h1>Confirmar eliminación de usuario</h1>

		<!-- Información del usuario a borrar -->
		<div class="mt-3">
			<p>
				¿Estás seguro de que deseas eliminar el siguiente usuario?
			</p>

			<div class="mt-2">
				<p><strong>Email:</strong> <span th:text="${user.email}">usuario@example.com</span></p>
				<p><strong>Nombre completo:</strong> <span th:text="${user.fullName}">Nombre Apellido</span></p>
				<p><strong>Administrador:</strong>
					<span th:text="${user.isAdmin ? 'Sí' : 'No'}"></span>
				</p>
				<p><strong>Creado el:</strong>
					<span th:text="${#temporals.format(user.creationTimestamp, 'yyyy-MM-dd HH:mm')}">
						2025-01-01 12:00
					</span>
				</p>
			</div>
		</div>

		<!-- Cuenta regresiva -->
		<p id="countdown" class="text-muted mt-4">
			Podrás confirmar en <span id="seconds">5</span> segundos...
		</p>

		<!-- Botones de confirmación -->
		<div class="mt-4">
			<form th:action="@{/user/delete/confirm}" method="post">
				<input type="hidden" name="id" th:value="${user.id}" />

				<!-- Botón rojo deshabilitado inicialmente -->
				<button id="confirmButton" type="submit"
				        class="btn btn-danger"
				        disabled>
					Sí, borrar completamente mi cuenta de usuario
				</button>

				<!-- Botón para cancelar -->
				<a class="btn" th:href="@{/main}" role="button">
					Cancelar
				</a>
			</form>
		</div>
	</section>
</main>

<!-- =======================
     BLOQUE DE SCRIPTS INYECTABLE
     ======================= -->
<script>
/**
 * Script de cuenta atrás de 5 segundos antes de habilitar
 * el botón de confirmación de borrado.
 */
document.addEventListener("DOMContentLoaded", () => {
	const countdownElement = document.getElementById("seconds");
	const confirmButton = document.getElementById("confirmButton");

	let remaining = 5;
	const timer = setInterval(() => {
		remaining--;
		countdownElement.textContent = remaining;

		if (remaining <= 0) {
			clearInterval(timer);
			confirmButton.disabled = false;
			document.getElementById("countdown").textContent =
				"Ya puedes confirmar la eliminación.";
		}
	}, 1000);
});
</script>

</html>

<!--
===============================================================================
NOTAS PEDAGÓGICAS
===============================================================================
1. USO DEL LAYOUT
-----------------
Se integra con el layout principal (layout(title, content, scripts)).
Esto garantiza una apariencia coherente en toda la aplicación.

2. LÓGICA DE CONFIRMACIÓN
--------------------------
El formulario POST apunta a `/user/delete/confirm`, donde el controlador
realiza la eliminación real del usuario tras esta confirmación.

3. CUENTA ATRÁS
---------------
El botón rojo "Sí, borrar completamente mi cuenta de usuario" está
deshabilitado durante los primeros 5 segundos para evitar pulsaciones
accidentales. Pasado ese tiempo, se habilita automáticamente.

4. SEGURIDAD
------------
Solo se accede a esta página si el usuario tiene permiso para eliminar
al usuario indicado (propio o, si es admin, otro usuario).
Esta verificación se realiza en el controlador mediante PermissionsService.

5. OBJETIVO PEDAGÓGICO
------------------------
Muestra cómo integrar interactividad básica en una aplicación Thymeleaf
usando el nuevo parámetro `scripts` del layout para inyectar JS específico
de la vista sin alterar el layout general.
===============================================================================
-->