<!-- vim: set tabstop=2 softtabstop=2 shiftwidth=2 noexpandtab textwidth=80 : -->

<!--
============================================================
LAYOUT PRINCIPAL DE LA APLICACIÓN
============================================================
Este archivo define la estructura base reutilizable para todas las páginas
de la aplicación (tanto públicas como privadas, excepto las de error).

Recibe tres parámetros:
 - `title`   → el título que se mostrará en la pestaña del navegador.
 - `content` → el bloque principal de contenido (la sección o main de la vista hija).
 - `scripts` → bloque opcional con scripts específicos para esa vista.

Se usa en cada plantilla de la siguiente forma:

<html th:replace="~{fragments/layout :: layout(
    title='Título de la página',
    content=~{::main},
    scripts=~{::script}
)}">

Si la plantilla hija no define un bloque <script>, el parámetro `scripts`
será null y el layout no insertará nada en su lugar.
-->

<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:fragment="layout(title, content, scripts)">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!--
  Si la variable `title` no está definida en la plantilla hija,
  se usará el valor por defecto "HtmlApp".
  -->
  <title th:text="${title} ?: 'HtmlApp'">HtmlApp</title>
  <link rel="stylesheet" th:href="@{/css/base.css}" />
</head>

<body>
  <!-- ============================================================
  CABECERA SUPERIOR (solo si hay usuario logado)
  ============================================================ -->
  <header th:if="${session.userId}"
          th:replace="~{fragments/header :: header}">
  </header>

  <!-- ============================================================
  CONTENEDOR PRINCIPAL
  ============================================================ -->
  <div class="page-container">
    <!-- Menú lateral, visible solo con sesión activa -->
    <aside th:if="${session.userId}"
           th:replace="~{fragments/sidebar :: sidebar}">
    </aside>

    <!-- Contenido dinámico de la vista hija -->
    <main th:replace="${content}"></main>
  </div>

  <!-- ============================================================
  MENSAJES GLOBALES DE SESIÓN
  ============================================================ -->
  <!--
  Este fragmento solo muestra actualmente
  el mensaje de cierre de sesión correcto (?logout).
  Se incluye globalmente en todas las páginas, pero solo se
  renderiza si la URL contiene el parámetro "logout".
  -->
  <div th:replace="~{fragments/logout-message :: logoutMessage}"></div>

  <!-- ============================================================
  PIE DE PÁGINA
  ============================================================ -->
  <footer th:replace="~{fragments/footer :: footer}"></footer>

  <!-- ============================================================
  BLOQUE OPCIONAL DE SCRIPTS ESPECÍFICOS
  ============================================================ -->
  <div th:if="${scripts != null}" th:replace="${scripts}"></div>
</body>
</html>

<!-- ============================================================
NOTAS DE DISEÑO Y FUNCIONAMIENTO
============================================================ -->
<!--
1. ESTRUCTURA GENERAL
----------------------
Este layout proporciona la estructura base del sitio:
cabecera condicional, menú lateral condicional, contenido y pie de página.

2. FRAGMENTOS REUTILIZADOS
---------------------------
- `fragments/header.html` → cabecera superior con nombre del usuario.
- `fragments/sidebar.html` → menú lateral (solo visible con sesión activa).
- `fragments/auth-message.html` → mensajes de autenticación o avisos globales.
- `fragments/footer.html` → pie de página común.

3. CONDICIONAL DE SESIÓN
-------------------------
Tanto el header como el sidebar se muestran únicamente cuando existe
una sesión activa: `th:if="${session.userId}"`.

4. VALOR POR DEFECTO DEL TÍTULO
--------------------------------
La expresión `th:text="${title} ?: 'HtmlApp'"` usa el operador Elvis (`?:`)
para establecer un valor por defecto. Si no se pasa ningún título,
se mostrará "HtmlApp" en la pestaña del navegador.

5. BLOQUE OPCIONAL DE SCRIPTS
------------------------------
El parámetro `scripts` permite que las plantillas hijas inyecten
código JavaScript específico al final del body. Si no se define,
el layout no renderiza nada en esa posición.

6. FRAGMENTO DE MENSAJES GLOBALES
---------------------------------
El fragmento `auth-message.html` se mantiene incluido para mostrar
mensajes globales. Actualmente solo se usa para mostrar la confirmación
de cierre de sesión (`?logout`). En el futuro puede ampliarse para
otros mensajes (registro, notificaciones, etc.).

7. OBJETIVO PEDAGÓGICO
------------------------
Este layout enseña cómo:
 - Crear un layout base con parámetros (title, content, scripts).
 - Reutilizar fragmentos con `th:replace`.
 - Controlar la visibilidad de elementos según la sesión.
 - Definir valores por defecto en Thymeleaf.
 - Inyectar fragmentos opcionales de scripts.
 - Integrar mensajes globales de sesión de forma modular.
 - Separar estructura HTML del contenido dinámico.
-->