<!-- vim: set tabstop=2 softtabstop=2 shiftwidth=2 noexpandtab textwidth=80 : -->
<!DOCTYPE html>
<html th:replace="~{fragments/layout :: layout(
    title='Gestión de usuarios',
    content=~{::main},
    scripts=~{::script}
)}">

<!-- ============================================================
LISTADO DE USUARIOS (ADMINISTRACIÓN)
============================================================ -->

<main>
  <section>
    <h1>Gestión de usuarios</h1>

    <form th:action="@{/admin/users/bulk}" method="post" id="bulkForm">
      <table>
        <thead>
          <tr>
            <th><input type="checkbox" id="selectAll"></th>
            <th>Email</th>
            <th>Nombre completo</th>
            <th>Admin</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="user : ${users}">
            <td>
              <input type="checkbox" name="ids"
                     th:value="${user.id}"
                     th:if="${user.id != session.userId}">
            </td>
            <td th:text="${user.email}"></td>
            <td th:text="${user.fullName}"></td>
            <td th:text="${user.isAdmin ? 'Sí' : 'No'}"></td>
            <td>
              <a th:href="@{/user/details/{id}(id=${user.id})}" class="btn">Ver</a>
              <a th:if="${user.id != session.userId}"
                 th:href="@{/user/delete/{id}(id=${user.id})}"
                 class="btn btn-danger">Eliminar</a>
            </td>
          </tr>
        </tbody>
      </table>

      <div class="table-actions">
        <button name="action" value="grant" class="btn">Dar admin</button>
        <button name="action" value="revoke" class="btn">Quitar admin</button>
        <button name="action" value="delete" class="btn btn-danger">Borrar</button>
      </div>
    </form>
  </section>
</main>

<!-- ============================================================
SCRIPTS
============================================================ -->
<script th:inline="javascript">
  /*
   * Controla la selección masiva de usuarios con el checkbox principal.
   * Cuando se selecciona "Seleccionar todos", marca o desmarca los demás.
   */
  document.addEventListener('DOMContentLoaded', () => {
    const selectAll = document.getElementById('selectAll');
    const checkboxes = document.querySelectorAll('input[name="ids"]');

    if (selectAll) {
      selectAll.addEventListener('change', () => {
        checkboxes.forEach(cb => cb.checked = selectAll.checked);
      });
    }
  });
</script>

</html>