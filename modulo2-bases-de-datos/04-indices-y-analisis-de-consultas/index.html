
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Juan Manuel Piñero Sánchez">
      
      
        <link rel="canonical" href="https://jmpinero-avante.github.io/ifcd0112avante-material/modulo2-bases-de-datos/04-indices-y-analisis-de-consultas/">
      
      
        <link rel="prev" href="../03-insercion-uso-y-eliminacion-de-datos/">
      
      
        <link rel="next" href="../05-programacion-con-funciones-y-procedimientos/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>04 – Índices y análisis de consultas - Módulo 2 – Bases de Datos</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2a3383ac.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../styles/code-font.css">
    
      <link rel="stylesheet" href="../styles/nav-toggle.css">
    
      <link rel="stylesheet" href="../styles/diagram.css">
    
      <link rel="stylesheet" href="../styles/desktop-drawer.css">
    
      <link rel="stylesheet" href="../styles/pdf-buttons.css">
    
      <link rel="stylesheet" href="../styles/pdf-academy.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#4-indices-y-analisis-de-consultas" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href=".." title="Módulo 2 – Bases de Datos" class="md-header__button md-logo" aria-label="Módulo 2 – Bases de Datos" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Módulo 2 – Bases de Datos
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              04 – Índices y análisis de consultas
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Cambiar a oscuro"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a oscuro" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Cambiar a claro"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a claro" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Módulo 2 – Bases de Datos" class="md-nav__button md-logo" aria-label="Módulo 2 – Bases de Datos" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Módulo 2 – Bases de Datos
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Índice
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-modelado-y-definicion-de-tablas-en-postgresql/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1 – Modelado y definición de tablas en PostgreSQL
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-consultas-en-postgresql/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    02 – Consultas en PostgreSQL
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-insercion-uso-y-eliminacion-de-datos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    03 – Inserción, uso y eliminación de datos
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    04 – Índices y análisis de consultas
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    04 – Índices y análisis de consultas
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#concepto-de-indice" class="md-nav__link">
    <span class="md-ellipsis">
      Concepto de índice
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#estructura-interna-el-indice-b-tree" class="md-nav__link">
    <span class="md-ellipsis">
      Estructura interna: el índice B-tree
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Estructura interna: el índice B-tree">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#como-funciona-un-b-tree" class="md-nav__link">
    <span class="md-ellipsis">
      Cómo funciona un B-tree
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#indices-implicitos" class="md-nav__link">
    <span class="md-ellipsis">
      Índices implícitos
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creacion-de-indices-manuales" class="md-nav__link">
    <span class="md-ellipsis">
      Creación de índices manuales
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#buenas-practicas-en-el-uso-de-indices" class="md-nav__link">
    <span class="md-ellipsis">
      Buenas prácticas en el uso de índices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analisis-de-rendimiento-con-explain-y-explain-analyze" class="md-nav__link">
    <span class="md-ellipsis">
      Análisis de rendimiento con EXPLAIN y EXPLAIN ANALYZE
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Análisis de rendimiento con EXPLAIN y EXPLAIN ANALYZE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#explain" class="md-nav__link">
    <span class="md-ellipsis">
      EXPLAIN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#explain-analyze" class="md-nav__link">
    <span class="md-ellipsis">
      EXPLAIN ANALYZE
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comparativa-de-rendimiento-sin-indice-y-con-indice" class="md-nav__link">
    <span class="md-ellipsis">
      Comparativa de rendimiento: sin índice y con índice
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mantenimiento-de-indices" class="md-nav__link">
    <span class="md-ellipsis">
      Mantenimiento de índices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ejemplo-completo" class="md-nav__link">
    <span class="md-ellipsis">
      Ejemplo completo
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resumen-final" class="md-nav__link">
    <span class="md-ellipsis">
      Resumen final
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-programacion-con-funciones-y-procedimientos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    05 – Programación con funciones y procedimientos
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../06-triggers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    06 – Triggers
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../07-casting-de-tipos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    07 – Casting de tipos
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../08-funciones-comunes-en-plpgsql/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    08 – Funciones comunes en PL/pgSQL
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../09-formatos-de-fecha-en-postgresql/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    09 – Formatos de fecha en PostgreSQL
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../10-instalacion-y-configuracion-de-postgresql-pgadmin-jdbc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    10 – Instalación y Configuración de PostgreSQL + pgAdmin + JDBC
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="4-indices-y-analisis-de-consultas">4 – Índices y análisis de consultas<a class="headerlink" href="#4-indices-y-analisis-de-consultas" title="Permanent link">&para;</a></h1>
<h2 id="concepto-de-indice">Concepto de índice<a class="headerlink" href="#concepto-de-indice" title="Permanent link">&para;</a></h2>
<p>Un índice es una estructura auxiliar que acelera la búsqueda y el acceso a los registros de una tabla.
Su función es reducir el número de filas que el motor de la base de datos necesita leer para localizar los datos que cumplen una condición.
Sin índice, PostgreSQL tiene que realizar un sequential scan (escaneo secuencial), revisando una por una todas las filas de la tabla.
Con un índice, puede saltar directamente a la ubicación donde se encuentran los datos relevantes, de forma análoga a cómo usamos el índice de un libro para encontrar rápidamente una palabra o tema.</p>
<h2 id="estructura-interna-el-indice-b-tree">Estructura interna: el índice B-tree<a class="headerlink" href="#estructura-interna-el-indice-b-tree" title="Permanent link">&para;</a></h2>
<p>El B-tree (Balanced Tree) es el tipo de índice más común en PostgreSQL (y en la mayoría de los SGBD).</p>
<h3 id="como-funciona-un-b-tree">Cómo funciona un B-tree<a class="headerlink" href="#como-funciona-un-b-tree" title="Permanent link">&para;</a></h3>
<p>Imagina un árbol ordenado:
Los nodos intermedios contienen claves que dividen el espacio de búsqueda.
Los nodos hoja contienen punteros a las filas reales en la tabla.
El árbol se mantiene equilibrado: todas las hojas están a la misma profundidad.
Esto garantiza que el tiempo de búsqueda, inserción y borrado sea logarítmico: O(log n).</p>
<div class="highlight"><pre><span></span><code>-
            [K=50]
           /     \
    [10,20,30] [60,70,80]
-
</code></pre></div>
<p>Cuando buscamos el valor 70, el árbol compara:
70 &gt; 50 → va a la rama derecha.
Busca en [60,70,80] → encuentra la posición exacta → devuelve la fila correspondiente.
El acceso es mucho más rápido que recorrer todos los registros secuencialmente.</p>
<h2 id="indices-implicitos">Índices implícitos<a class="headerlink" href="#indices-implicitos" title="Permanent link">&para;</a></h2>
<p>PostgreSQL crea automáticamente algunos índices sin que el usuario los pida:</p>
<p>Clave primaria (PRIMARY KEY):</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">usuarios</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">nombre</span><span class="w"> </span><span class="nb">TEXT</span>
<span class="p">);</span>
</code></pre></div>
<p>Crea automáticamente un índice B-tree sobre id.</p>
<p>Restricciones UNIQUE:</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">productos</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">codigo</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">UNIQUE</span>
<span class="p">);</span>
</code></pre></div>
<p>Crea un índice implícito que garantiza la unicidad de codigo.
Estos índices automáticos son esenciales para mantener la integridad referencial y acelerar las búsquedas por claves.</p>
<h2 id="creacion-de-indices-manuales">Creación de índices manuales<a class="headerlink" href="#creacion-de-indices-manuales" title="Permanent link">&para;</a></h2>
<p>Índice básico:</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_usuarios_nombre</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">usuarios</span><span class="w"> </span><span class="p">(</span><span class="n">nombre</span><span class="p">);</span>
</code></pre></div>
<p>Índice en orden descendente:</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_pedidos_fecha_desc</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">pedidos</span><span class="w"> </span><span class="p">(</span><span class="n">fecha</span><span class="w"> </span><span class="k">DESC</span><span class="p">);</span>
</code></pre></div>
<p>Índice múltiple (o compuesto):</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_clientes_apellido_ciudad</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">clientes</span><span class="w"> </span><span class="p">(</span><span class="n">apellido</span><span class="p">,</span><span class="w"> </span><span class="n">ciudad</span><span class="p">);</span>
</code></pre></div>
<p>Importante:
Los índices múltiples se aprovechan por su primera columna y las subsecuentes, en ese orden.</p>
<p>Por ejemplo:</p>
<div class="highlight"><pre><span></span><code><span class="k">WHERE</span><span class="w"> </span><span class="n">apellido</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;García&#39;</span>
<span class="w">    </span><span class="c1">-- ✅ usa el índice.</span>

<span class="k">WHERE</span><span class="w"> </span><span class="n">apellido</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;García&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">ciudad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Sevilla&#39;</span>
<span class="w">    </span><span class="c1">-- ✅ usa el índice.</span>

<span class="k">WHERE</span><span class="w"> </span><span class="n">ciudad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Sevilla&#39;</span>
<span class="w">    </span><span class="c1">-- ❌ no usa el índice</span>
<span class="w">    </span><span class="c1">-- (la primera columna apellido no se filtra).</span>
</code></pre></div>
<p>Este comportamiento se conoce como regla del prefijo del índice.</p>
<p>Índice parcial:</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_activos</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">empleados</span><span class="w"> </span><span class="p">(</span><span class="n">dni</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">activo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
</code></pre></div>
<p>Ideal para grandes tablas con muchas filas inactivas.</p>
<p>Índice único:</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">UNIQUE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_email_unico</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">usuarios</span><span class="w"> </span><span class="p">(</span><span class="n">email</span><span class="p">);</span>
</code></pre></div>
<p>Garantiza que no se repitan valores en esa columna.</p>
<h2 id="buenas-practicas-en-el-uso-de-indices">Buenas prácticas en el uso de índices<a class="headerlink" href="#buenas-practicas-en-el-uso-de-indices" title="Permanent link">&para;</a></h2>
<ul>
<li>Usar índices en columnas que aparecen con frecuencia en cláusulas WHERE, condiciones de JOIN, ORDER BY o GROUP BY.</li>
<li>No indexar todo: cada índice ocupa espacio y ralentiza INSERT, UPDATE y DELETE.</li>
<li>Evitar índices en columnas con baja selectividad (por ejemplo, un campo BOOLEAN con casi todos los valores iguales).</li>
<li>Analizar el tamaño de los índices.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">relname</span><span class="p">,</span><span class="w"> </span><span class="n">pg_size_pretty</span><span class="p">(</span><span class="n">pg_total_relation_size</span><span class="p">(</span><span class="n">indexrelid</span><span class="p">))</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">pg_stat_user_indexes</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">schemaname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;public&#39;</span><span class="p">;</span>
</code></pre></div>
<p>Actualizar estadísticas regularmente:</p>
<div class="highlight"><pre><span></span><code><span class="k">VACUUM</span><span class="w"> </span><span class="k">ANALYZE</span><span class="p">;</span>
</code></pre></div>
<p>Esto ayuda al optimizador a tomar decisiones más acertadas.</p>
<h2 id="analisis-de-rendimiento-con-explain-y-explain-analyze">Análisis de rendimiento con EXPLAIN y EXPLAIN ANALYZE<a class="headerlink" href="#analisis-de-rendimiento-con-explain-y-explain-analyze" title="Permanent link">&para;</a></h2>
<h3 id="explain">EXPLAIN<a class="headerlink" href="#explain" title="Permanent link">&para;</a></h3>
<p>Muestra el plan estimado de ejecución:</p>
<div class="highlight"><pre><span></span><code><span class="k">EXPLAIN</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">usuarios</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">nombre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Juan&#39;</span><span class="p">;</span>
</code></pre></div>
<p>Salida:</p>
<div class="highlight"><pre><span></span><code>Index Scan using idx_usuarios_nombre on usuarios  (cost=0.15..8.17 rows=1 width=48)
</code></pre></div>
<table>
<thead>
<tr>
<th>Componente</th>
<th>Significado</th>
</tr>
</thead>
<tbody>
<tr>
<td>Index Scan</td>
<td>Está usando el índice.</td>
</tr>
<tr>
<td>cost</td>
<td>Estimación del optimizador.</td>
</tr>
</tbody>
</table>
<h3 id="explain-analyze">EXPLAIN ANALYZE<a class="headerlink" href="#explain-analyze" title="Permanent link">&para;</a></h3>
<p>Ejecuta realmente la consulta y muestra los tiempos reales:</p>
<div class="highlight"><pre><span></span><code><span class="k">EXPLAIN</span><span class="w"> </span><span class="k">ANALYZE</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">usuarios</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">nombre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Juan&#39;</span><span class="p">;</span>
</code></pre></div>
<p>Ejemplo de salida:</p>
<div class="highlight"><pre><span></span><code>Index Scan using idx_usuarios_nombre on usuarios  (cost=0.15..8.17 rows=1 width=48)
(actual time=0.030..0.035 rows=1 loops=1)
</code></pre></div>
<table>
<thead>
<tr>
<th>Componente</th>
<th>Significado</th>
</tr>
</thead>
<tbody>
<tr>
<td>cost</td>
<td>Coste estimado (cuanto menor, mejor).</td>
</tr>
<tr>
<td>actual time</td>
<td>Tiempo real de ejecución.</td>
</tr>
<tr>
<td>rows</td>
<td>Número de filas encontradas.</td>
</tr>
<tr>
<td>loops</td>
<td>Veces que se repitió el plan (en subconsultas o bucles).</td>
</tr>
</tbody>
</table>
<h2 id="comparativa-de-rendimiento-sin-indice-y-con-indice">Comparativa de rendimiento: sin índice y con índice<a class="headerlink" href="#comparativa-de-rendimiento-sin-indice-y-con-indice" title="Permanent link">&para;</a></h2>
<p>Supón que tenemos 1 millón de filas en usuarios:</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">usuarios</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">nombre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Juan&#39;</span><span class="p">;</span>
</code></pre></div>
<p>Sin índice:</p>
<div class="highlight"><pre><span></span><code>Seq Scan on usuarios (cost=0.00..25000.00 rows=1 width=48)
(actual time=50.000..50.001 rows=1 loops=1)
</code></pre></div>
<p>Con índice:</p>
<div class="highlight"><pre><span></span><code>Index Scan using idx_usuarios_nombre on usuarios (cost=0.15..8.17 rows=1 width=48)
(actual time=0.035..0.036 rows=1 loops=1)
</code></pre></div>
<p>El acceso pasa de 50 ms a 0.03 ms, un ahorro enorme.</p>
<h2 id="mantenimiento-de-indices">Mantenimiento de índices<a class="headerlink" href="#mantenimiento-de-indices" title="Permanent link">&para;</a></h2>
<p>Comprobar el uso de índices:</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">   </span><span class="n">relname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">tabla</span><span class="p">,</span>
<span class="w">   </span><span class="n">indexrelname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">indice</span><span class="p">,</span>
<span class="w">   </span><span class="n">idx_scan</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">veces_usado</span><span class="p">,</span>
<span class="w">   </span><span class="n">idx_tup_read</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">tuplas_leidas</span><span class="p">,</span>
<span class="w">   </span><span class="n">idx_tup_fetch</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">tuplas_devueltas</span>
<span class="k">FROM</span>
<span class="w">   </span><span class="n">pg_stat_user_indexes</span>
<span class="k">WHERE</span>
<span class="w">   </span><span class="n">schemaname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;public&#39;</span><span class="p">;</span>
</code></pre></div>
<p>Esta vista muestra cuántas veces se ha utilizado cada índice desde el último reinicio de estadísticas.</p>
<p>Reindexar un índice específico:</p>
<div class="highlight"><pre><span></span><code><span class="k">REINDEX</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_usuarios_nombre</span><span class="p">;</span>
</code></pre></div>
<p>Reindexar una tabla completa:</p>
<div class="highlight"><pre><span></span><code><span class="k">REINDEX</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">usuarios</span><span class="p">;</span>
</code></pre></div>
<p>Ver todos los índices existentes:</p>
<div class="highlight"><pre><span></span><code><span class="err">\</span><span class="n">di</span>
</code></pre></div>
<h2 id="ejemplo-completo">Ejemplo completo<a class="headerlink" href="#ejemplo-completo" title="Permanent link">&para;</a></h2>
<p>Supongamos una tabla de pedidos:</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">pedidos</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">cliente_id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
<span class="w">    </span><span class="n">fecha</span><span class="w"> </span><span class="nb">DATE</span><span class="p">,</span>
<span class="w">    </span><span class="n">total</span><span class="w"> </span><span class="nb">DECIMAL</span>
<span class="p">);</span>
</code></pre></div>
<p>Creamos un índice para acelerar búsquedas por fecha:</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_pedidos_fecha</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">pedidos</span><span class="w"> </span><span class="p">(</span><span class="n">fecha</span><span class="p">);</span>
</code></pre></div>
<p>Consultamos:</p>
<div class="highlight"><pre><span></span><code><span class="k">EXPLAIN</span><span class="w"> </span><span class="k">ANALYZE</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">pedidos</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">fecha</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;2025-01-01&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;2025-03-31&#39;</span><span class="p">;</span>
</code></pre></div>
<p>Si el rango abarca pocas filas: “Index Scan”.<br />
Si abarca la mayoría: “Seq Scan” (el optimizador decide que leer toda la tabla es más rápido).</p>
<h2 id="resumen-final">Resumen final<a class="headerlink" href="#resumen-final" title="Permanent link">&para;</a></h2>
<ul>
<li>Los índices mejoran la velocidad de lectura pero empeoran ligeramente la escritura.</li>
<li>Los B-trees son los índices por defecto y más versátiles.</li>
<li>Los índices compuestos funcionan en orden de las columnas, empezando por la primera.</li>
<li>Usa EXPLAIN ANALYZE para comprobar si se usan correctamente.</li>
<li>Revisa estadísticas periódicamente y evita sobreindexar.</li>
</ul>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Volver al principio
</button>
        
      </main>
      
        <footer class="md-footer">
  <div class="md-footer-meta md-typeset" style="text-align:center; font-size:0.85em; margin-top:1em;">
    <p>
      <a href="https://www.avante.es/" style="text-decoration:none;" target="_blank">
      <img src="../assets/avante-logo.png"
           alt="Avante" width="80"
           style="vertical-align:middle; margin-right:8px;">
      </a>
      Hecho con amor por <strong>Juan Manuel Piñero Sánchez</strong> · © 2025
    </p>
  </div>
</footer>

      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.expand", "navigation.sections", "navigation.top", "navigation.hide", "toc.integrate", "header.autohide", "content.code.copy"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>